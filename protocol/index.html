<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>efixDI+ Protocol | Admin Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
    <style>
        :root{--black:#000;--white:#fff;--gray-50:#fafafa;--gray-100:#f5f5f5;--gray-200:#e5e5e5;--gray-300:#d4d4d4;--gray-400:#a3a3a3;--gray-500:#737373;--gray-600:#525252;--gray-700:#404040;--gray-800:#262626;--gray-900:#171717;--green:#22c55e;--green-bg:#f0fdf4;--green-border:#bbf7d0;--red:#ef4444;--red-bg:#fef2f2;--red-border:#fecaca;--orange:#f59e0b;--orange-bg:#fffbeb;--orange-border:#fde68a;--blue:#3b82f6;--blue-bg:#eff6ff;--blue-border:#bfdbfe;--purple:#8b5cf6;--purple-bg:#f5f3ff;--purple-border:#ddd6fe}
        *{margin:0;padding:0;box-sizing:border-box}html{scroll-behavior:smooth}
        body{font-family:'Syne',-apple-system,sans-serif;background:var(--gray-50);color:var(--black);line-height:1.7;min-height:100vh}
        ::selection{background:var(--black);color:var(--white)}
        nav{position:fixed;top:0;left:0;right:0;background:rgba(255,255,255,.95);backdrop-filter:blur(20px);border-bottom:1px solid var(--gray-200);z-index:1000;padding:1rem 2rem}
        .nav-content{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
        .nav-brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--black)}
        .nav-brand-icon{width:32px;height:32px;background:var(--black);color:var(--white);border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:11px}
        .nav-brand-text{font-weight:700;font-size:1.1rem}
        .nav-admin-badge{background:var(--gray-900);color:var(--white);padding:2px 8px;border-radius:4px;font-size:.65rem;font-weight:700;letter-spacing:.08em;text-transform:uppercase}
        .nav-right{display:flex;align-items:center;gap:1rem}
        .nav-link{color:var(--gray-500);text-decoration:none;font-size:.85rem;font-weight:500;padding:6px 12px;border-radius:6px;transition:all .2s}
        .nav-link:hover{color:var(--black);background:var(--gray-100)}
        .connect-btn{background:var(--black);color:var(--white);border:none;padding:10px 20px;border-radius:8px;font-family:'Syne',sans-serif;font-weight:600;font-size:.85rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:8px}
        .connect-btn:hover{background:var(--gray-800);transform:translateY(-1px)}
        .connect-btn.connected{background:var(--white);color:var(--black);border:1px solid var(--gray-200)}
        .connect-dot{width:7px;height:7px;border-radius:50%;background:var(--green)}
        .main{max-width:1400px;margin:0 auto;padding:96px 2rem 80px}
        .page-header{margin-bottom:40px}
        .page-header h1{font-size:2rem;font-weight:800;letter-spacing:-.03em;margin-bottom:4px}
        .page-header p{color:var(--gray-500);font-size:.95rem}
        .status-bar{display:flex;gap:12px;margin-bottom:32px;flex-wrap:wrap}
        .status-pill{display:flex;align-items:center;gap:6px;padding:6px 14px;background:var(--white);border:1px solid var(--gray-200);border-radius:100px;font-size:.8rem;font-weight:500;color:var(--gray-600)}
        .dot{width:6px;height:6px;border-radius:50%}.dot.green{background:var(--green)}.dot.orange{background:var(--orange)}.dot.blue{background:var(--blue)}
        .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
        .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:20px}
        .card{background:var(--white);border:1px solid var(--gray-200);border-radius:12px;padding:24px;transition:border-color .2s;animation:fadeIn .4s ease-out both}
        .card:hover{border-color:var(--gray-300)}
        .card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
        .card-title{font-size:.85rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;color:var(--gray-500)}
        .card-badge{padding:3px 10px;border-radius:100px;font-size:.7rem;font-weight:700;letter-spacing:.04em}
        .card-badge.live{background:var(--green-bg);color:var(--green);border:1px solid var(--green-border)}
        .metric-value{font-family:'Space Mono',monospace;font-size:2rem;font-weight:700;letter-spacing:-.02em;line-height:1.2}
        .metric-label{font-size:.8rem;color:var(--gray-500);margin-top:4px}
        .metric-change{display:inline-flex;align-items:center;gap:4px;font-size:.75rem;font-weight:600;padding:2px 8px;border-radius:4px;margin-top:8px}
        .metric-change.up{background:var(--green-bg);color:var(--green)}
        .stat-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid var(--gray-100)}
        .stat-row:last-child{border-bottom:none}
        .stat-label{color:var(--gray-500);font-size:.875rem}
        .stat-value{font-family:'Space Mono',monospace;font-weight:700;font-size:.875rem}
        .contract-row{display:flex;align-items:center;gap:12px;padding:10px 14px;background:var(--gray-50);border-radius:8px;margin-bottom:6px;border:1px solid var(--gray-100);transition:border-color .2s}
        .contract-row:hover{border-color:var(--gray-300)}
        .contract-label{color:var(--gray-500);font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.06em;min-width:100px}
        .contract-addr{font-family:'Space Mono',monospace;font-size:.75rem;color:var(--gray-700);flex:1;overflow:hidden;text-overflow:ellipsis}
        .contract-link{color:var(--gray-400);text-decoration:none;font-size:.7rem;font-weight:600;padding:4px 8px;border-radius:4px;border:1px solid var(--gray-200);transition:all .2s;white-space:nowrap}
        .contract-link:hover{color:var(--black);border-color:var(--gray-400)}
        .integration-row{display:flex;align-items:center;gap:14px;padding:16px;background:var(--gray-50);border-radius:10px;margin-bottom:8px;border:1px solid var(--gray-100)}
        .integration-icon{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
        .integration-icon.green-bg{background:var(--green-bg);border:1px solid var(--green-border)}
        .integration-icon.orange-bg{background:var(--orange-bg);border:1px solid var(--orange-border)}
        .integration-icon.blue-bg{background:var(--blue-bg);border:1px solid var(--blue-border)}
        .integration-icon.purple-bg{background:var(--purple-bg);border:1px solid var(--purple-border)}
        .integration-info{flex:1}.integration-name{font-weight:700;font-size:.9rem;margin-bottom:1px}.integration-desc{font-size:.8rem;color:var(--gray-500)}
        .integration-status{padding:4px 12px;border-radius:100px;font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.04em}
        .integration-status.online{background:var(--green-bg);color:var(--green)}
        .integration-status.pending{background:var(--orange-bg);color:var(--orange)}
        .integration-status.audit{background:var(--purple-bg);color:var(--purple)}
        .section-title{font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--gray-400);margin-bottom:16px;margin-top:12px}
        .check-item{display:flex;align-items:center;gap:10px;padding:10px 0;border-bottom:1px solid var(--gray-100);font-size:.875rem}
        .check-item:last-child{border-bottom:none}
        .check-box{width:20px;height:20px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0}
        .check-box.done{background:var(--green-bg);color:var(--green);border:1px solid var(--green-border)}
        .check-box.pending{background:var(--orange-bg);color:var(--orange);border:1px solid var(--orange-border)}
        .check-box.todo{background:var(--gray-100);color:var(--gray-400);border:1px solid var(--gray-200)}
        .check-text.done{color:var(--gray-400);text-decoration:line-through}
        .toast{position:fixed;bottom:24px;right:24px;background:var(--gray-900);color:var(--white);padding:14px 24px;border-radius:10px;font-size:.85rem;font-weight:500;z-index:2000;transform:translateY(100px);opacity:0;transition:all .3s cubic-bezier(.4,0,.2,1)}
        .toast.show{transform:translateY(0);opacity:1}
        footer{text-align:center;padding:40px 2rem;color:var(--gray-400);font-size:.8rem;border-top:1px solid var(--gray-200)}
        footer a{color:var(--gray-600);text-decoration:none}footer a:hover{text-decoration:underline}
        @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .grid-4 .card:nth-child(1){animation-delay:0s}.grid-4 .card:nth-child(2){animation-delay:.05s}.grid-4 .card:nth-child(3){animation-delay:.1s}.grid-4 .card:nth-child(4){animation-delay:.15s}
        @media(max-width:1024px){.grid-4{grid-template-columns:1fr 1fr}.grid-2{grid-template-columns:1fr}}
        @media(max-width:640px){nav{padding:.75rem 1rem}.main{padding:80px 1rem 60px}.page-header h1{font-size:1.5rem}.metric-value{font-size:1.5rem}.nav-link{display:none}}
    </style>
</head>
<body>
    <nav><div class="nav-content">
        <a href="/" class="nav-brand"><div class="nav-brand-icon">eF</div><span class="nav-brand-text">efixDI+</span><span class="nav-admin-badge">Admin</span></a>
        <div class="nav-right"><a href="/app" class="nav-link">App</a><a href="/" class="nav-link">Site</a><button class="connect-btn" id="connectBtn" onclick="connectWallet()">Conectar Wallet</button></div>
    </div></nav>

    <main class="main">
        <div class="page-header"><h1>Protocol Dashboard</h1><p>Monitoramento de contratos, integra√ß√µes e m√©tricas do protocolo efixDI+</p></div>
        <div class="status-bar">
            <div class="status-pill"><span class="dot green"></span> Polygon</div>
            <div class="status-pill"><span class="dot blue"></span> Base</div>
            <div class="status-pill"><span class="dot green"></span> Chainlink</div>
            <div class="status-pill"><span class="dot green"></span> HausBank</div>
            <div class="status-pill"><span class="dot orange"></span> Genial IAAS</div>
        </div>

        <div class="grid-4">
            <div class="card"><div class="card-header"><span class="card-title">TVL</span><span class="card-badge live">Live</span></div><div class="metric-value" id="tvlValue">R$ ‚Äî</div><div class="metric-label">Total Value Locked</div></div>
            <div class="card"><div class="card-header"><span class="card-title">BRL/USD</span></div><div class="metric-value" id="brlUsdValue">‚Äî</div><div class="metric-label">Chainlink Price Feed</div></div>
            <div class="card"><div class="card-header"><span class="card-title">CDI Base</span></div><div class="metric-value">15.00%</div><div class="metric-label">Taxa Selic / CDI</div><div class="metric-change up">Est√°vel</div></div>
            <div class="card"><div class="card-header"><span class="card-title">APY Range</span></div><div class="metric-value">22‚Äî38%</div><div class="metric-label">1-4 loops leverage</div></div>
        </div>

        <div class="section-title">Integra√ß√µes & Servi√ßos</div>
        <div class="grid-2">
            <div class="card"><div class="card-header"><span class="card-title">Status das Integra√ß√µes</span></div>
                <div class="integration-row"><div class="integration-icon green-bg">üè¶</div><div class="integration-info"><div class="integration-name">HausBank API</div><div class="integration-desc">PIX deposits & withdrawals ¬∑ haus-api2.iholdbank.digital</div></div><span class="integration-status online">Online</span></div>
                <div class="integration-row"><div class="integration-icon green-bg">üîó</div><div class="integration-info"><div class="integration-name">Chainlink Oracle</div><div class="integration-desc">BRL/USD price feed ¬∑ Polygon Mainnet</div></div><span class="integration-status online">Online</span></div>
                <div class="integration-row"><div class="integration-icon blue-bg">üåâ</div><div class="integration-info"><div class="integration-name">LayerZero V2</div><div class="integration-desc">OFT Bridge ¬∑ Polygon ‚Üî Base</div></div><span class="integration-status online">Active</span></div>
                <div class="integration-row"><div class="integration-icon blue-bg">üèõÔ∏è</div><div class="integration-info"><div class="integration-name">Morpho Blue</div><div class="integration-desc">Lending market ¬∑ efixDI/USDC ¬∑ 77% LTV</div></div><span class="integration-status online">Active</span></div>
                <div class="integration-row"><div class="integration-icon orange-bg">üìä</div><div class="integration-info"><div class="integration-name">Genial IAAS</div><div class="integration-desc">Compra/venda cotas fundo DI ¬∑ Aguardando credenciais</div></div><span class="integration-status pending">Pending</span></div>
                <div class="integration-row"><div class="integration-icon purple-bg">üõ°Ô∏è</div><div class="integration-info"><div class="integration-name">OpenZeppelin</div><div class="integration-desc">Security audit ¬∑ Discovery phase conclu√≠da</div></div><span class="integration-status audit">Audit</span></div>
            </div>
            <div class="card"><div class="card-header"><span class="card-title">Par√¢metros do Protocolo</span></div>
                <div class="stat-row"><span class="stat-label">Max LTV</span><span class="stat-value">75%</span></div>
                <div class="stat-row"><span class="stat-label">Liquidation Threshold</span><span class="stat-value">80%</span></div>
                <div class="stat-row"><span class="stat-label">Min Health Factor</span><span class="stat-value" style="color:var(--orange)">1.15</span></div>
                <div class="stat-row"><span class="stat-label">Max Leverage Loops</span><span class="stat-value">4</span></div>
                <div class="stat-row"><span class="stat-label">TVL Cap</span><span class="stat-value">R$ 10M</span></div>
                <div class="stat-row"><span class="stat-label">Performance Fee</span><span class="stat-value">10 bps</span></div>
                <div class="stat-row"><span class="stat-label">Withdrawal Fee</span><span class="stat-value">5 bps</span></div>
                <div class="stat-row"><span class="stat-label">USDC Borrow Cost</span><span class="stat-value" style="color:var(--blue)">~5% a.a.</span></div>
                <div class="stat-row"><span class="stat-label">Regula√ß√£o CVM</span><span class="stat-value" style="color:var(--green)">Resolu√ß√£o 88/2022</span></div>
            </div>
        </div>

        <div class="section-title">Contratos Deployados</div>
        <div class="grid-2">
            <div class="card"><div class="card-header"><span class="card-title">Polygon Mainnet</span><span class="card-badge live">Chain 137</span></div>
                <div class="contract-row"><span class="contract-label">EfixDIToken</span><span class="contract-addr">0x04082b283818D9d0dd9Ee8742892eEe5CC396441</span><a class="contract-link" href="https://polygonscan.com/address/0x04082b283818D9d0dd9Ee8742892eEe5CC396441" target="_blank">Scan ‚Üó</a></div>
                <div class="contract-row"><span class="contract-label">VaultV2</span><span class="contract-addr">0x2eA512b4C5e53A8c1302AC8ba2d43c5DA90b307C</span><a class="contract-link" href="https://polygonscan.com/address/0x2eA512b4C5e53A8c1302AC8ba2d43c5DA90b307C" target="_blank">Scan ‚Üó</a></div>
                <div class="contract-row"><span class="contract-label">Gateway</span><span class="contract-addr">0xf54D741F919313b87ea67F0BE8999DA68470C495</span><a class="contract-link" href="https://polygonscan.com/address/0xf54D741F919313b87ea67F0BE8999DA68470C495" target="_blank">Scan ‚Üó</a></div>
                <div class="contract-row"><span class="contract-label">OFT Adapter</span><span class="contract-addr">0x9437Cc8f7a313b9E1F36c3a070E9eC8ab799966B</span><a class="contract-link" href="https://polygonscan.com/address/0x9437Cc8f7a313b9E1F36c3a070E9eC8ab799966B" target="_blank">Scan ‚Üó</a></div>
                <div class="contract-row"><span class="contract-label">Oracle</span><span class="contract-addr">0xB90DA3ff54C3ED09115abf6FbA0Ff4645586af2c</span><a class="contract-link" href="https://polygonscan.com/address/0xB90DA3ff54C3ED09115abf6FbA0Ff4645586af2c" target="_blank">Scan ‚Üó</a></div>
                <div class="contract-row"><span class="contract-label">USDC.e</span><span class="contract-addr">0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174</span><a class="contract-link" href="https://polygonscan.com/address/0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174" target="_blank">Scan ‚Üó</a></div>
                <div class="contract-row"><span class="contract-label">BRTH</span><span class="contract-addr">0x38fd02Dc840F099772392f2DFe3A3BEE9Aab3AB7</span><a class="contract-link" href="https://polygonscan.com/address/0x38fd02Dc840F099772392f2DFe3A3BEE9Aab3AB7" target="_blank">Scan ‚Üó</a></div>
            </div>
            <div class="card"><div class="card-header"><span class="card-title">Base Mainnet</span><span class="card-badge live">Chain 8453</span></div>
                <div class="contract-row"><span class="contract-label">EfixDIBase</span><span class="contract-addr">0xF5cA55f3ea5Bcd180aEa6dF9E05a0E63A66f5608</span><a class="contract-link" href="https://basescan.org/address/0xF5cA55f3ea5Bcd180aEa6dF9E05a0E63A66f5608" target="_blank">Scan ‚Üó</a></div>
                <div class="contract-row"><span class="contract-label">BRL Oracle</span><span class="contract-addr">0xF4e20ff5a1a3B6251b2c460c6b221a52bED85aA9</span><a class="contract-link" href="https://basescan.org/address/0xF4e20ff5a1a3B6251b2c460c6b221a52bED85aA9" target="_blank">Scan ‚Üó</a></div>
                <div class="contract-row"><span class="contract-label">MorphoVault</span><span class="contract-addr">0x5A611498C96C3871d0bA131f207e5E05c713A06A</span><a class="contract-link" href="https://basescan.org/address/0x5A611498C96C3871d0bA131f207e5E05c713A06A" target="_blank">Scan ‚Üó</a></div>
                <div class="contract-row"><span class="contract-label">OFT Base</span><span class="contract-addr">0x08F73b66aAFe61618Fe244a2F06C4f8750eadFa2</span><a class="contract-link" href="https://basescan.org/address/0x08F73b66aAFe61618Fe244a2F06C4f8750eadFa2" target="_blank">Scan ‚Üó</a></div>
                <div class="contract-row" style="align-items:flex-start"><span class="contract-label">Morpho Mkt</span><span class="contract-addr" style="font-size:.65rem;word-break:break-all">0x31d65cadef8eb085dd3bead61b987b3f86a7ac7d3e1f4763f6d4ec6a477d345a</span><a class="contract-link" href="https://app.morpho.org" target="_blank">Morpho ‚Üó</a></div>
            </div>
        </div>

        <div class="section-title">Roadmap</div>
        <div class="card">
            <div class="card-header"><span class="card-title">Checklist de Produ√ß√£o</span></div>
            <div class="check-item"><div class="check-box done">‚úì</div><span class="check-text done">Deploy smart contracts Polygon Mainnet</span></div>
            <div class="check-item"><div class="check-box done">‚úì</div><span class="check-text done">Deploy smart contracts Base Mainnet</span></div>
            <div class="check-item"><div class="check-box done">‚úì</div><span class="check-text done">LayerZero Bridge peers configurados (Polygon ‚Üî Base)</span></div>
            <div class="check-item"><div class="check-box done">‚úì</div><span class="check-text done">Mercado Morpho Blue criado (efixDI/USDC, 77% LTV)</span></div>
            <div class="check-item"><div class="check-box done">‚úì</div><span class="check-text done">Auto-minting PIX ‚Üí efixDI funcional</span></div>
            <div class="check-item"><div class="check-box done">‚úì</div><span class="check-text done">Leverage testado (1 loop: R$ 375 ‚Üí R$ 638, HF 2.06)</span></div>
            <div class="check-item"><div class="check-box pending">‚óî</div><span class="check-text">Supply USDC liquidity ao mercado Morpho</span></div>
            <div class="check-item"><div class="check-box pending">‚óî</div><span class="check-text">Integrar Genial IAAS API (falta: URL base, JWT, cdBolsa, fundoId)</span></div>
            <div class="check-item"><div class="check-box pending">‚óî</div><span class="check-text">Testar fluxo E2E completo com bridge cross-chain</span></div>
            <div class="check-item"><div class="check-box pending">‚óî</div><span class="check-text">Verificar contratos nos block explorers</span></div>
            <div class="check-item"><div class="check-box pending">‚óî</div><span class="check-text">Resolver PERMISSION_NOT_GRANTED cash-out HausBank</span></div>
            <div class="check-item"><div class="check-box todo">‚óã</div><span class="check-text">Finalizar auditoria OpenZeppelin (~$50K)</span></div>
            <div class="check-item"><div class="check-box todo">‚óã</div><span class="check-text">Deploy backend webhook para dep√≥sitos autom√°ticos</span></div>
            <div class="check-item"><div class="check-box todo">‚óã</div><span class="check-text">Stress test sob volatilidade BRL/USD</span></div>
        </div>

        <div class="section-title">Wallet Operacional</div>
        <div class="grid-2">
            <div class="card"><div class="card-header"><span class="card-title">Saldos On-Chain</span></div>
                <div class="stat-row"><span class="stat-label">MATIC (Polygon)</span><span class="stat-value" id="maticBal">‚Äî</span></div>
                <div class="stat-row"><span class="stat-label">efixDI Tokens</span><span class="stat-value" id="efixBal" style="color:var(--green)">‚Äî</span></div>
                <div class="stat-row"><span class="stat-label">USDC.e</span><span class="stat-value" id="usdcBal" style="color:var(--blue)">‚Äî</span></div>
                <div class="stat-row"><span class="stat-label">BRTH</span><span class="stat-value" id="brthBal">‚Äî</span></div>
            </div>
            <div class="card"><div class="card-header"><span class="card-title">Compliance</span></div>
                <div class="stat-row"><span class="stat-label">Emissor</span><span class="stat-value">Efix Securitizadora</span></div>
                <div class="stat-row"><span class="stat-label">Regula√ß√£o</span><span class="stat-value" style="color:var(--green)">CVM Res. 88/2022</span></div>
                <div class="stat-row"><span class="stat-label">Infraestrutura</span><span class="stat-value">HausBank (iHold)</span></div>
                <div class="stat-row"><span class="stat-label">Fundo DI</span><span class="stat-value" style="color:var(--orange)">Genial (pendente)</span></div>
                <div class="stat-row"><span class="stat-label">Auditoria</span><span class="stat-value" style="color:var(--purple)">OpenZeppelin (em curso)</span></div>
            </div>
        </div>
    </main>

    <div class="toast" id="toast"></div>
    <footer>efixDI+ Protocol ¬∑ Admin ¬∑ <a href="/">efix.finance</a> ¬∑ <a href="/app">App</a> ¬∑ <a href="https://polygonscan.com/address/0x2eA512b4C5e53A8c1302AC8ba2d43c5DA90b307C" target="_blank">VaultV2</a></footer>

    <script>
        var CONTRACTS = {
            efixDIToken: '0x04082b283818D9d0dd9Ee8742892eEe5CC396441',
            vault: '0x2eA512b4C5e53A8c1302AC8ba2d43c5DA90b307C',
            oracle: '0xB90DA3ff54C3ED09115abf6FbA0Ff4645586af2c',
            usdce: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174',
            brth: '0x38fd02Dc840F099772392f2DFe3A3BEE9Aab3AB7'
        };
        var POLYGON_CHAIN_ID = '0x89';
        var provider = null, signer = null, userAddress = null;
        var ERC20_ABI = ['function balanceOf(address) view returns (uint256)'];
        var ORACLE_ABI = ['function latestRoundData() view returns (uint80, int256, uint256, uint256, uint80)'];
        var VAULT_ABI = ['function totalValueLocked() view returns (uint256)'];

        async function connectWallet() {
            if (!window.ethereum) { showToast('MetaMask nao encontrada'); return; }
            try {
                var accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                var chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== POLYGON_CHAIN_ID) {
                    try { await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: POLYGON_CHAIN_ID }] }); }
                    catch(e) { if(e.code===4902) await window.ethereum.request({ method:'wallet_addEthereumChain', params:[{chainId:POLYGON_CHAIN_ID,chainName:'Polygon',nativeCurrency:{name:'MATIC',symbol:'MATIC',decimals:18},rpcUrls:['https://polygon-rpc.com'],blockExplorerUrls:['https://polygonscan.com']}]}); }
                }
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                userAddress = accounts[0];
                var btn = document.getElementById('connectBtn');
                btn.innerHTML = '<span class="connect-dot"></span>' + userAddress.slice(0,6) + '...' + userAddress.slice(-4);
                btn.classList.add('connected');
                showToast('Conectado - Polygon Mainnet');
                loadData();
            } catch(err) { showToast('Erro: ' + err.message); }
        }

        async function loadData() {
            if (!provider || !userAddress) return;
            try {
                var bal = await provider.getBalance(userAddress);
                document.getElementById('maticBal').textContent = parseFloat(ethers.formatEther(bal)).toFixed(4);
            } catch(e) {}
            try { var c = new ethers.Contract(CONTRACTS.efixDIToken, ERC20_ABI, provider); var b = await c.balanceOf(userAddress); document.getElementById('efixBal').textContent = parseFloat(ethers.formatEther(b)).toFixed(2); } catch(e) { document.getElementById('efixBal').textContent = '0.00'; }
            try { var c = new ethers.Contract(CONTRACTS.usdce, ERC20_ABI, provider); var b = await c.balanceOf(userAddress); document.getElementById('usdcBal').textContent = '$' + parseFloat(ethers.formatUnits(b, 6)).toFixed(2); } catch(e) { document.getElementById('usdcBal').textContent = '$0.00'; }
            try { var c = new ethers.Contract(CONTRACTS.brth, ERC20_ABI, provider); var b = await c.balanceOf(userAddress); document.getElementById('brthBal').textContent = parseFloat(ethers.formatEther(b)).toFixed(2); } catch(e) { document.getElementById('brthBal').textContent = '0.00'; }
            try { var oracle = new ethers.Contract(CONTRACTS.oracle, ORACLE_ABI, provider); var data = await oracle.latestRoundData(); var rate = parseFloat(ethers.formatUnits(data[1], 8)); document.getElementById('brlUsdValue').textContent = rate.toFixed(4); } catch(e) {}
            try { var vault = new ethers.Contract(CONTRACTS.vault, VAULT_ABI, provider); var tvl = await vault.totalValueLocked(); var val = parseFloat(ethers.formatEther(tvl)); document.getElementById('tvlValue').textContent = 'R$ ' + val.toLocaleString('pt-BR', {minimumFractionDigits: 2}); } catch(e) { document.getElementById('tvlValue').textContent = 'R$ 0.00'; }
        }

        function showToast(msg) {
            var t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(function() { t.classList.remove('show'); }, 3000);
        }

        setInterval(function() { if (provider) loadData(); }, 30000);
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', function() { window.location.reload(); });
            window.ethereum.on('chainChanged', function() { window.location.reload(); });
        }
    </script>
</body>
</html>
