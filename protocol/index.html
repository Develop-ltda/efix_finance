<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>efixDI+ Protocol | Dashboard</title>
    <meta name="description" content="Gerencie suas posi√ß√µes efixDI+ ‚Äî Renda fixa brasileira tokenizada com yields de 25-38% APY via alavancagem DeFi.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root {
            --bg-primary: #06090f;
            --bg-secondary: #0d1117;
            --bg-card: #161b22;
            --bg-card-hover: #1c2128;
            --bg-elevated: #21262d;
            --border-color: rgba(48, 54, 61, 0.8);
            --border-glow: #00ff88;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --text-muted: #484f58;
            --accent-green: #00ff88;
            --accent-green-dim: rgba(0, 255, 136, 0.15);
            --accent-cyan: #00ccff;
            --accent-cyan-dim: rgba(0, 204, 255, 0.12);
            --accent-orange: #ff9800;
            --accent-red: #ff4444;
            --accent-red-dim: rgba(255, 68, 68, 0.12);
            --gradient-main: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
            --gradient-bg: linear-gradient(135deg, #06090f 0%, #0d1117 50%, #0a0f16 100%);
            --font-display: 'Outfit', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-display);
            background: var(--gradient-bg);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
        }

        /* Background grid pattern */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: 
                linear-gradient(rgba(0, 255, 136, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 136, 0.02) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
            z-index: 0;
        }

        /* Glow orbs */
        body::after {
            content: '';
            position: fixed;
            top: -200px;
            right: -200px;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(0, 255, 136, 0.06) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        /* Navigation */
        .nav {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(6, 9, 15, 0.85);
            backdrop-filter: blur(20px) saturate(180%);
            border-bottom: 1px solid var(--border-color);
            padding: 0 24px;
        }
        .nav-inner {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }
        .nav-logo {
            width: 36px;
            height: 36px;
            background: var(--gradient-main);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 14px;
            color: var(--bg-primary);
        }
        .nav-title {
            font-weight: 700;
            font-size: 18px;
            color: var(--text-primary);
        }
        .nav-title span {
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .nav-links {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .nav-link {
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            background: none;
            font-family: var(--font-display);
        }
        .nav-link:hover, .nav-link.active {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }
        .nav-link.active {
            color: var(--accent-green);
        }

        /* Connect Button */
        .btn-connect {
            padding: 10px 20px;
            border-radius: var(--radius-md);
            border: 1px solid var(--accent-green);
            background: var(--accent-green-dim);
            color: var(--accent-green);
            font-family: var(--font-display);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-connect:hover {
            background: rgba(0, 255, 136, 0.25);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
            transform: translateY(-1px);
        }
        .btn-connect.connected {
            border-color: var(--accent-green);
            background: rgba(0, 255, 136, 0.1);
        }
        .btn-connect .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-green);
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.4); }
            50% { opacity: 0.8; box-shadow: 0 0 0 6px rgba(0, 255, 136, 0); }
        }

        /* Main Layout */
        .main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px 24px 80px;
            position: relative;
            z-index: 1;
        }

        /* Protocol Banner */
        .protocol-banner {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.08) 0%, rgba(0, 204, 255, 0.06) 100%);
            border: 1px solid rgba(0, 255, 136, 0.15);
            border-radius: var(--radius-xl);
            padding: 32px 40px;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 24px;
            position: relative;
            overflow: hidden;
        }
        .protocol-banner::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -10%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(0, 255, 136, 0.06) 0%, transparent 70%);
            pointer-events: none;
        }
        .banner-info h1 {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 6px;
        }
        .banner-info h1 span {
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .banner-info p {
            color: var(--text-secondary);
            font-size: 15px;
        }
        .banner-stats {
            display: flex;
            gap: 32px;
            flex-shrink: 0;
        }
        .banner-stat {
            text-align: center;
        }
        .banner-stat-value {
            font-family: var(--font-mono);
            font-size: 24px;
            font-weight: 700;
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .banner-stat-label {
            font-size: 12px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 2px;
        }

        /* Network Badge */
        .network-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        .network-badge.polygon {
            background: rgba(130, 71, 229, 0.15);
            color: #a855f7;
            border: 1px solid rgba(130, 71, 229, 0.3);
        }
        .network-badge .net-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
        }

        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }
        .dashboard-grid.triple {
            grid-template-columns: 1fr 1fr 1fr;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 28px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        .card:hover {
            border-color: rgba(0, 255, 136, 0.2);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
        }
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card-title .card-icon {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        .card-icon.green { background: var(--accent-green-dim); }
        .card-icon.cyan { background: var(--accent-cyan-dim); }
        .card-icon.orange { background: rgba(255, 152, 0, 0.12); }
        .card-icon.red { background: var(--accent-red-dim); }
        .card-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .card-badge.live {
            background: rgba(0, 255, 136, 0.12);
            color: var(--accent-green);
        }
        .card-badge.beta {
            background: rgba(255, 152, 0, 0.12);
            color: var(--accent-orange);
        }

        /* Stat rows */
        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid rgba(48, 54, 61, 0.4);
        }
        .stat-row:last-child { border-bottom: none; }
        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        .stat-value {
            font-family: var(--font-mono);
            font-weight: 600;
            font-size: 15px;
            color: var(--text-primary);
        }
        .stat-value.green { color: var(--accent-green); }
        .stat-value.cyan { color: var(--accent-cyan); }
        .stat-value.orange { color: var(--accent-orange); }
        .stat-value.red { color: var(--accent-red); }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 14px 24px;
            border-radius: var(--radius-md);
            border: none;
            font-family: var(--font-display);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none !important;
        }
        .btn-primary {
            background: var(--gradient-main);
            color: var(--bg-primary);
        }
        .btn-primary:hover:not(:disabled) {
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        .btn-secondary:hover:not(:disabled) {
            border-color: var(--accent-cyan);
            background: rgba(0, 204, 255, 0.08);
        }
        .btn-danger {
            background: var(--accent-red-dim);
            color: var(--accent-red);
            border: 1px solid rgba(255, 68, 68, 0.3);
        }
        .btn-danger:hover:not(:disabled) {
            background: rgba(255, 68, 68, 0.2);
        }
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        /* Input */
        .input-group {
            margin-bottom: 16px;
        }
        .input-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        .input-label .max-btn {
            color: var(--accent-green);
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            background: none;
            border: none;
            font-family: var(--font-display);
        }
        .input-label .max-btn:hover { text-decoration: underline; }
        .input-field {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
            outline: none;
        }
        .input-field:focus {
            border-color: var(--accent-green);
            box-shadow: 0 0 0 3px rgba(0, 255, 136, 0.1);
        }
        .input-field::placeholder {
            color: var(--text-muted);
            font-weight: 400;
        }

        /* Leverage Slider */
        .slider-container { margin: 20px 0; }
        .slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        .slider-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        .slider-value {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--accent-green);
        }
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: var(--bg-secondary);
            border-radius: 3px;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--accent-green);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.4);
        }

        /* Health Factor Gauge */
        .hf-gauge {
            text-align: center;
            padding: 20px 0;
        }
        .hf-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            margin: 0 auto 16px;
            border: 3px solid;
            transition: all 0.5s;
        }
        .hf-circle.safe {
            border-color: var(--accent-green);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.15);
        }
        .hf-circle.warning {
            border-color: var(--accent-orange);
            box-shadow: 0 0 30px rgba(255, 152, 0, 0.15);
        }
        .hf-circle.danger {
            border-color: var(--accent-red);
            box-shadow: 0 0 30px rgba(255, 68, 68, 0.15);
            animation: pulse-danger 1.5s infinite;
        }
        @keyframes pulse-danger {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 68, 68, 0.15); }
            50% { box-shadow: 0 0 50px rgba(255, 68, 68, 0.3); }
        }
        .hf-number {
            font-family: var(--font-mono);
            font-size: 28px;
            font-weight: 700;
        }
        .hf-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* PIX Section */
        .pix-qr {
            background: white;
            border-radius: var(--radius-md);
            padding: 16px;
            width: 180px;
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 16px auto;
        }
        .pix-info {
            text-align: center;
            padding: 12px;
            background: rgba(0, 255, 136, 0.06);
            border-radius: var(--radius-md);
            border: 1px dashed rgba(0, 255, 136, 0.2);
            margin-top: 16px;
        }
        .pix-key {
            font-family: var(--font-mono);
            font-size: 13px;
            color: var(--accent-green);
            word-break: break-all;
        }
        .copy-btn {
            margin-top: 8px;
            padding: 6px 16px;
            background: var(--accent-green-dim);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: var(--radius-sm);
            color: var(--accent-green);
            font-family: var(--font-display);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .copy-btn:hover {
            background: rgba(0, 255, 136, 0.2);
        }

        /* Transaction Log */
        .tx-log {
            max-height: 300px;
            overflow-y: auto;
            padding: 4px 0;
        }
        .tx-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: var(--radius-sm);
            margin-bottom: 4px;
            transition: background 0.2s;
        }
        .tx-item:hover { background: rgba(255, 255, 255, 0.02); }
        .tx-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        .tx-icon.deposit { background: var(--accent-green-dim); }
        .tx-icon.withdraw { background: var(--accent-red-dim); }
        .tx-icon.leverage { background: var(--accent-cyan-dim); }
        .tx-details { flex: 1; min-width: 0; }
        .tx-type {
            font-size: 13px;
            font-weight: 600;
        }
        .tx-hash {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--text-muted);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .tx-hash a {
            color: var(--text-muted);
            text-decoration: none;
        }
        .tx-hash a:hover { color: var(--accent-cyan); }
        .tx-amount {
            font-family: var(--font-mono);
            font-weight: 600;
            font-size: 13px;
            text-align: right;
            flex-shrink: 0;
        }

        /* Status Indicators */
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        .status-dot.online { background: var(--accent-green); box-shadow: 0 0 8px rgba(0, 255, 136, 0.5); }
        .status-dot.offline { background: var(--accent-red); }
        .status-dot.syncing { background: var(--accent-orange); animation: pulse-dot 1s infinite; }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 80px;
            right: 24px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .toast {
            padding: 14px 20px;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: toast-in 0.3s ease-out;
            min-width: 300px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        .toast.success {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: var(--accent-green);
        }
        .toast.error {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            color: var(--accent-red);
        }
        .toast.info {
            background: rgba(0, 204, 255, 0.1);
            border: 1px solid rgba(0, 204, 255, 0.3);
            color: var(--accent-cyan);
        }
        @keyframes toast-in {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Loading spinner */
        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid transparent;
            border-top-color: currentColor;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: var(--text-muted);
        }
        .empty-state .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        .empty-state p {
            font-size: 15px;
            max-width: 320px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-secondary);
            padding: 4px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 10px 16px;
            border-radius: var(--radius-sm);
            border: none;
            background: none;
            color: var(--text-secondary);
            font-family: var(--font-display);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab.active {
            background: var(--bg-card);
            color: var(--text-primary);
        }
        .tab:hover:not(.active) {
            color: var(--text-primary);
        }

        /* Contracts info */
        .contract-address {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: var(--bg-secondary);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            font-size: 12px;
        }
        .contract-address .ca-label {
            color: var(--text-muted);
            min-width: 80px;
            font-weight: 500;
        }
        .contract-address .ca-value {
            font-family: var(--font-mono);
            color: var(--text-secondary);
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }
        .contract-address .ca-link {
            color: var(--accent-cyan);
            text-decoration: none;
            flex-shrink: 0;
            font-size: 11px;
        }
        .contract-address .ca-link:hover { text-decoration: underline; }

        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .dashboard-grid.triple { grid-template-columns: 1fr; }
            .protocol-banner { flex-direction: column; text-align: center; }
            .banner-stats { justify-content: center; }
        }
        @media (max-width: 640px) {
            .nav-inner { padding: 0; }
            .nav-links { display: none; }
            .main { padding: 16px 12px 60px; }
            .protocol-banner { padding: 24px 20px; }
            .banner-info h1 { font-size: 22px; }
            .card { padding: 20px; }
            .btn-group { flex-direction: column; }
        }

        /* Section Separator */
        .section-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 16px;
            padding-left: 4px;
        }

        /* Full width card */
        .card.full { grid-column: 1 / -1; }

        /* Animated gradient border on focus */
        .card.active-card {
            border-image: linear-gradient(135deg, var(--accent-green), var(--accent-cyan)) 1;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 24px;
            color: var(--text-muted);
            font-size: 13px;
            border-top: 1px solid var(--border-color);
            margin-top: 60px;
        }
        .footer a {
            color: var(--accent-green);
            text-decoration: none;
        }
        .footer a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;

    // ===== CONTRACT CONFIG =====
    // Polygon Mainnet (137)
    const CONTRACTS = {
        efixDIToken: '0x04082b283818D9d0dd9Ee8742892eEe5CC396441',
        vault: '0x2eA512b4C5e53A8c1302AC8ba2d43c5DA90b307C',
        gateway: '0xf54D741F919313b87ea67F0BE8999DA68470C495',
        oftAdapter: '0x9437Cc8f7a313b9E1F36c3a070E9eC8ab799966B',
        oracle: '0xB90DA3ff54C3ED09115abf6FbA0Ff4645586af2c',
        usdce: '0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174',
        brth: '0x38fd02Dc840F099772392f2DFe3A3BEE9Aab3AB7',
    };
    // Base Mainnet (8453)
    const CONTRACTS_BASE = {
        efixDITokenBase: '0xF5cA55f3ea5Bcd180aEa6dF9E05a0E63A66f5608',
        brlOracle: '0xF4e20ff5a1a3B6251b2c460c6b221a52bED85aA9',
        morphoVaultV2: '0x5A611498C96C3871d0bA131f207e5E05c713A06A',
        oftBase: '0x08F73b66aAFe61618Fe244a2F06C4f8750eadFa2',
        morphoMarketId: '0x31d65cadef8eb085dd3bead61b987b3f86a7ac7d3e1f4763f6d4ec6a477d345a',
    };

    const POLYGON_CHAIN_ID = '0x89';
    const POLYGON_CONFIG = {
        chainId: POLYGON_CHAIN_ID,
        chainName: 'Polygon Mainnet',
        nativeCurrency: { name: 'MATIC', symbol: 'MATIC', decimals: 18 },
        rpcUrls: ['https://polygon-rpc.com', 'https://rpc-mainnet.maticvigil.com'],
        blockExplorerUrls: ['https://polygonscan.com'],
    };

    // Minimal ABIs
    const ERC20_ABI = [
        'function balanceOf(address) view returns (uint256)',
        'function decimals() view returns (uint8)',
        'function symbol() view returns (string)',
        'function approve(address spender, uint256 amount) returns (bool)',
        'function allowance(address owner, address spender) view returns (uint256)',
    ];

    const VAULT_ABI = [
        'function positions(address) view returns (uint256 principal, uint256 efixDIBalance, uint256 borrowedUSDC, uint256 leverageLoops, uint256 lastUpdateTimestamp, bool hedgeActive)',
        'function getHealthFactor(address user) view returns (uint256)',
        'function totalValueLocked() view returns (uint256)',
        'function config() view returns (uint256 maxLTV, uint256 liquidationThreshold, uint256 maxLoops, uint256 minHealthFactor, uint256 tvlCap, uint256 performanceFee, uint256 withdrawalFee)',
        'function applyLeverage(uint8 loops) external',
        'function deleverage(uint8 loops) external',
        'function requestWithdrawal(uint256 amount) external',
    ];

    const ORACLE_ABI = [
        'function latestRoundData() view returns (uint80, int256, uint256, uint256, uint80)',
    ];

    // ===== TOAST SYSTEM =====
    function ToastContainer({ toasts }) {
        return (
            <div className="toast-container">
                {toasts.map((t, i) => (
                    <div key={i} className={`toast ${t.type}`}>
                        {t.type === 'success' ? '‚úì' : t.type === 'error' ? '‚úï' : '‚Ñπ'}
                        {t.message}
                    </div>
                ))}
            </div>
        );
    }

    // ===== MAIN APP =====
    function App() {
        // State
        const [account, setAccount] = useState(null);
        const [chainId, setChainId] = useState(null);
        const [provider, setProvider] = useState(null);
        const [signer, setSigner] = useState(null);
        const [activeTab, setActiveTab] = useState('deposit');
        const [activeSection, setActiveSection] = useState('dashboard');
        const [toasts, setToasts] = useState([]);
        const [loading, setLoading] = useState({});

        // Position data
        const [position, setPosition] = useState({
            principal: '0',
            efixDIBalance: '0',
            borrowedUSDC: '0',
            leverageLoops: 0,
            healthFactor: '0',
            hedgeActive: false,
        });

        // Balances
        const [balances, setBalances] = useState({
            matic: '0',
            efixDI: '0',
            usdce: '0',
            brth: '0',
        });

        // Protocol stats
        const [protocolStats, setProtocolStats] = useState({
            tvl: '0',
            brlUsdRate: '0',
            cdiRate: '15.00',
            estimatedAPY: '0',
        });

        // Form state
        const [depositAmount, setDepositAmount] = useState('');
        const [withdrawAmount, setWithdrawAmount] = useState('');
        const [leverageLoops, setLeverageLoops] = useState(1);

        // Transactions
        const [transactions, setTransactions] = useState([]);

        // Toast helper
        const addToast = useCallback((message, type = 'info') => {
            setToasts(prev => [...prev, { message, type }]);
            setTimeout(() => setToasts(prev => prev.slice(1)), 4000);
        }, []);

        // ===== WALLET CONNECTION =====
        const connectWallet = async () => {
            if (!window.ethereum) {
                addToast('MetaMask n√£o encontrada. Instale em metamask.io', 'error');
                return;
            }
            try {
                setLoading(prev => ({ ...prev, connect: true }));
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const currentChainId = await window.ethereum.request({ method: 'eth_chainId' });

                if (currentChainId !== POLYGON_CHAIN_ID) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: POLYGON_CHAIN_ID }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [POLYGON_CONFIG],
                            });
                        }
                    }
                }

                const web3Provider = new ethers.providers.Web3Provider(window.ethereum);
                const web3Signer = web3Provider.getSigner();

                setAccount(accounts[0]);
                setChainId(POLYGON_CHAIN_ID);
                setProvider(web3Provider);
                setSigner(web3Signer);
                addToast('Wallet conectada com sucesso!', 'success');
            } catch (err) {
                addToast('Erro ao conectar wallet: ' + err.message, 'error');
            } finally {
                setLoading(prev => ({ ...prev, connect: false }));
            }
        };

        // ===== DATA FETCHING =====
        const fetchData = useCallback(async () => {
            if (!provider || !account) return;
            try {
                // Balances
                const maticBal = await provider.getBalance(account);

                let efixDIBal = ethers.BigNumber.from(0);
                let usdceBal = ethers.BigNumber.from(0);
                let brthBal = ethers.BigNumber.from(0);

                try {
                    const efixDIContract = new ethers.Contract(CONTRACTS.efixDIToken, ERC20_ABI, provider);
                    efixDIBal = await efixDIContract.balanceOf(account);
                } catch(e) { /* token may not be deployed yet */ }

                try {
                    const usdceContract = new ethers.Contract(CONTRACTS.usdce, ERC20_ABI, provider);
                    usdceBal = await usdceContract.balanceOf(account);
                } catch(e) {}

                try {
                    const brthContract = new ethers.Contract(CONTRACTS.brth, ERC20_ABI, provider);
                    brthBal = await brthContract.balanceOf(account);
                } catch(e) {}

                setBalances({
                    matic: parseFloat(ethers.utils.formatEther(maticBal)).toFixed(4),
                    efixDI: parseFloat(ethers.utils.formatEther(efixDIBal)).toFixed(2),
                    usdce: parseFloat(ethers.utils.formatUnits(usdceBal, 6)).toFixed(2),
                    brth: parseFloat(ethers.utils.formatEther(brthBal)).toFixed(2),
                });

                // Oracle - BRL/USD
                try {
                    const oracleContract = new ethers.Contract(CONTRACTS.oracle, ORACLE_ABI, provider);
                    const [, answer] = await oracleContract.latestRoundData();
                    const rate = parseFloat(ethers.utils.formatUnits(answer, 8));
                    setProtocolStats(prev => ({ ...prev, brlUsdRate: rate.toFixed(4) }));
                } catch(e) {}

                // Vault position
                try {
                    const vaultContract = new ethers.Contract(CONTRACTS.vault, VAULT_ABI, provider);
                    const pos = await vaultContract.positions(account);
                    
                    let hf = '0';
                    try {
                        const hfRaw = await vaultContract.getHealthFactor(account);
                        hf = parseFloat(ethers.utils.formatUnits(hfRaw, 4)).toFixed(2);
                    } catch(e) {}

                    let tvl = '0';
                    try {
                        const tvlRaw = await vaultContract.totalValueLocked();
                        tvl = parseFloat(ethers.utils.formatEther(tvlRaw)).toFixed(2);
                    } catch(e) {}

                    setPosition({
                        principal: parseFloat(ethers.utils.formatEther(pos.principal)).toFixed(2),
                        efixDIBalance: parseFloat(ethers.utils.formatEther(pos.efixDIBalance)).toFixed(2),
                        borrowedUSDC: parseFloat(ethers.utils.formatUnits(pos.borrowedUSDC, 6)).toFixed(2),
                        leverageLoops: pos.leverageLoops.toNumber(),
                        healthFactor: hf,
                        hedgeActive: pos.hedgeActive,
                    });

                    setProtocolStats(prev => ({ ...prev, tvl }));
                } catch(e) {}

                // Estimate APY
                const cdi = 15;
                const borrowCost = 5;
                let apy = cdi;
                let mult = 1;
                for (let i = 0; i < leverageLoops; i++) {
                    mult *= 0.75;
                    apy += (cdi - borrowCost) * mult;
                }
                setProtocolStats(prev => ({ ...prev, estimatedAPY: apy.toFixed(1) }));

            } catch (err) {
                console.error('Fetch error:', err);
            }
        }, [provider, account, leverageLoops]);

        useEffect(() => {
            fetchData();
            const interval = setInterval(fetchData, 15000);
            return () => clearInterval(interval);
        }, [fetchData]);

        // Wallet event listeners
        useEffect(() => {
            if (!window.ethereum) return;
            const handleAccountsChanged = (accounts) => {
                if (accounts.length === 0) {
                    setAccount(null);
                    setSigner(null);
                } else {
                    setAccount(accounts[0]);
                }
            };
            const handleChainChanged = () => window.location.reload();

            window.ethereum.on('accountsChanged', handleAccountsChanged);
            window.ethereum.on('chainChanged', handleChainChanged);
            return () => {
                window.ethereum.removeListener('accountsChanged', handleAccountsChanged);
                window.ethereum.removeListener('chainChanged', handleChainChanged);
            };
        }, []);

        // ===== ACTIONS =====
        const handleLeverage = async () => {
            if (!signer) return addToast('Conecte a wallet primeiro', 'error');
            try {
                setLoading(prev => ({ ...prev, leverage: true }));
                addToast(`Aplicando ${leverageLoops} loop(s) de alavancagem...`, 'info');
                const vault = new ethers.Contract(CONTRACTS.vault, VAULT_ABI, signer);
                const tx = await vault.applyLeverage(leverageLoops, { gasLimit: 500000 });
                addToast('Transa√ß√£o enviada. Aguardando confirma√ß√£o...', 'info');
                const receipt = await tx.wait();
                addToast(`Alavancagem aplicada! TX: ${receipt.transactionHash.slice(0, 10)}...`, 'success');
                setTransactions(prev => [{
                    type: 'Leverage',
                    hash: receipt.transactionHash,
                    amount: `${leverageLoops} loops`,
                    icon: 'leverage',
                }, ...prev]);
                fetchData();
            } catch (err) {
                addToast('Erro na alavancagem: ' + (err.reason || err.message), 'error');
            } finally {
                setLoading(prev => ({ ...prev, leverage: false }));
            }
        };

        const handleDeleverage = async () => {
            if (!signer) return addToast('Conecte a wallet primeiro', 'error');
            try {
                setLoading(prev => ({ ...prev, deleverage: true }));
                addToast('Removendo alavancagem...', 'info');
                const vault = new ethers.Contract(CONTRACTS.vault, VAULT_ABI, signer);
                const tx = await vault.deleverage(1, { gasLimit: 500000 });
                const receipt = await tx.wait();
                addToast(`Desalavancagem conclu√≠da! TX: ${receipt.transactionHash.slice(0, 10)}...`, 'success');
                setTransactions(prev => [{
                    type: 'Deleverage',
                    hash: receipt.transactionHash,
                    amount: '-1 loop',
                    icon: 'withdraw',
                }, ...prev]);
                fetchData();
            } catch (err) {
                addToast('Erro na desalavancagem: ' + (err.reason || err.message), 'error');
            } finally {
                setLoading(prev => ({ ...prev, deleverage: false }));
            }
        };

        const handleWithdraw = async () => {
            if (!signer || !withdrawAmount) return addToast('Insira o valor', 'error');
            try {
                setLoading(prev => ({ ...prev, withdraw: true }));
                addToast(`Solicitando saque de R$ ${withdrawAmount}...`, 'info');
                const vault = new ethers.Contract(CONTRACTS.vault, VAULT_ABI, signer);
                const amount = ethers.utils.parseEther(withdrawAmount);
                const tx = await vault.requestWithdrawal(amount, { gasLimit: 300000 });
                const receipt = await tx.wait();
                addToast(`Saque solicitado! PIX ser√° enviado em breve.`, 'success');
                setTransactions(prev => [{
                    type: 'Withdraw',
                    hash: receipt.transactionHash,
                    amount: `R$ ${withdrawAmount}`,
                    icon: 'withdraw',
                }, ...prev]);
                setWithdrawAmount('');
                fetchData();
            } catch (err) {
                addToast('Erro no saque: ' + (err.reason || err.message), 'error');
            } finally {
                setLoading(prev => ({ ...prev, withdraw: false }));
            }
        };

        // ===== HELPERS =====
        const shortAddr = (addr) => addr ? `${addr.slice(0, 6)}...${addr.slice(-4)}` : '';
        const getHFClass = (hf) => {
            const val = parseFloat(hf);
            if (val >= 1.5) return 'safe';
            if (val >= 1.15) return 'warning';
            return 'danger';
        };
        const getHFColor = (hf) => {
            const val = parseFloat(hf);
            if (val >= 1.5) return 'green';
            if (val >= 1.15) return 'orange';
            return 'red';
        };

        // Calculate estimated APY based on loops
        const calcAPY = (loops) => {
            const cdi = 15;
            const cost = 5;
            let apy = cdi;
            let mult = 1;
            for (let i = 0; i < loops; i++) {
                mult *= 0.75;
                apy += (cdi - cost) * mult;
            }
            return apy.toFixed(1);
        };

        // ===== RENDER =====
        return (
            <div>
                <ToastContainer toasts={toasts} />

                {/* Navigation */}
                <nav className="nav">
                    <div className="nav-inner">
                        <a href="/" className="nav-brand">
                            <div className="nav-logo">eF</div>
                            <div className="nav-title">efix<span>DI+</span></div>
                        </a>
                        <div className="nav-links">
                            <button className={`nav-link ${activeSection === 'dashboard' ? 'active' : ''}`}
                                onClick={() => setActiveSection('dashboard')}>Dashboard</button>
                            <button className={`nav-link ${activeSection === 'contracts' ? 'active' : ''}`}
                                onClick={() => setActiveSection('contracts')}>Contratos</button>
                            <a href="/" className="nav-link">‚Üê Site</a>
                        </div>
                        <button className={`btn-connect ${account ? 'connected' : ''}`} onClick={connectWallet}>
                            {loading.connect ? (
                                <span className="spinner"></span>
                            ) : account ? (
                                <><span className="dot"></span>{shortAddr(account)}</>
                            ) : (
                                'ü¶ä Conectar Wallet'
                            )}
                        </button>
                    </div>
                </nav>

                {/* Main Content */}
                <main className="main">
                    {/* Protocol Banner */}
                    <div className="protocol-banner">
                        <div className="banner-info">
                            <div className="network-badge polygon">
                                <span className="net-dot"></span>
                                Polygon Mainnet
                            </div>
                            <h1>efixDI+ <span>Protocol</span></h1>
                            <p>Renda fixa brasileira tokenizada com alavancagem DeFi</p>
                        </div>
                        <div className="banner-stats">
                            <div className="banner-stat">
                                <div className="banner-stat-value">
                                    {protocolStats.estimatedAPY}%
                                </div>
                                <div className="banner-stat-label">APY Estimado</div>
                            </div>
                            <div className="banner-stat">
                                <div className="banner-stat-value">
                                    {protocolStats.cdiRate}%
                                </div>
                                <div className="banner-stat-label">CDI Base</div>
                            </div>
                            <div className="banner-stat">
                                <div className="banner-stat-value">
                                    {protocolStats.brlUsdRate || '‚Äî'}
                                </div>
                                <div className="banner-stat-label">BRL/USD</div>
                            </div>
                        </div>
                    </div>

                    {activeSection === 'dashboard' && (
                        <>
                            {/* Wallet Overview + Position */}
                            <div className="section-title">Sua Posi√ß√£o</div>
                            <div className="dashboard-grid">
                                {/* Wallet Balances */}
                                <div className="card">
                                    <div className="card-header">
                                        <div className="card-title">
                                            <div className="card-icon green">üí∞</div>
                                            Carteira
                                        </div>
                                        <span className="card-badge live">Live</span>
                                    </div>
                                    {account ? (
                                        <>
                                            <div className="stat-row">
                                                <span className="stat-label">MATIC</span>
                                                <span className="stat-value">{balances.matic}</span>
                                            </div>
                                            <div className="stat-row">
                                                <span className="stat-label">efixDI</span>
                                                <span className="stat-value green">{balances.efixDI}</span>
                                            </div>
                                            <div className="stat-row">
                                                <span className="stat-label">USDC.e</span>
                                                <span className="stat-value cyan">{balances.usdce}</span>
                                            </div>
                                            <div className="stat-row">
                                                <span className="stat-label">BRTH</span>
                                                <span className="stat-value">{balances.brth}</span>
                                            </div>
                                        </>
                                    ) : (
                                        <div className="empty-state">
                                            <div className="empty-icon">üîí</div>
                                            <p>Conecte sua MetaMask para ver seus saldos e operar no protocolo.</p>
                                        </div>
                                    )}
                                </div>

                                {/* Position + Health Factor */}
                                <div className="card">
                                    <div className="card-header">
                                        <div className="card-title">
                                            <div className="card-icon cyan">üìä</div>
                                            Posi√ß√£o
                                        </div>
                                    </div>
                                    {account && parseFloat(position.principal) > 0 ? (
                                        <>
                                            <div className="hf-gauge">
                                                <div className={`hf-circle ${getHFClass(position.healthFactor)}`}>
                                                    <span className={`hf-number ${getHFColor(position.healthFactor)}`} style={{color: `var(--accent-${getHFColor(position.healthFactor)})`}}>
                                                        {position.healthFactor}
                                                    </span>
                                                    <span className="hf-label">Health Factor</span>
                                                </div>
                                            </div>
                                            <div className="stat-row">
                                                <span className="stat-label">Principal (BRL)</span>
                                                <span className="stat-value">R$ {position.principal}</span>
                                            </div>
                                            <div className="stat-row">
                                                <span className="stat-label">efixDI Total</span>
                                                <span className="stat-value green">{position.efixDIBalance}</span>
                                            </div>
                                            <div className="stat-row">
                                                <span className="stat-label">USDC Emprestado</span>
                                                <span className="stat-value orange">${position.borrowedUSDC}</span>
                                            </div>
                                            <div className="stat-row">
                                                <span className="stat-label">Loops Ativos</span>
                                                <span className="stat-value">{position.leverageLoops}</span>
                                            </div>
                                        </>
                                    ) : (
                                        <div className="empty-state">
                                            <div className="empty-icon">üìã</div>
                                            <p>{account ? 'Nenhuma posi√ß√£o aberta. Deposite via PIX para come√ßar.' : 'Conecte a wallet para ver sua posi√ß√£o.'}</p>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Operations */}
                            <div className="section-title" style={{marginTop: '8px'}}>Opera√ß√µes</div>
                            <div className="dashboard-grid">
                                {/* Deposit / Withdraw */}
                                <div className="card">
                                    <div className="card-header">
                                        <div className="card-title">
                                            <div className="card-icon green">üí∏</div>
                                            Dep√≥sito & Saque
                                        </div>
                                    </div>
                                    <div className="tabs">
                                        <button className={`tab ${activeTab === 'deposit' ? 'active' : ''}`}
                                            onClick={() => setActiveTab('deposit')}>Depositar PIX</button>
                                        <button className={`tab ${activeTab === 'withdraw' ? 'active' : ''}`}
                                            onClick={() => setActiveTab('withdraw')}>Sacar PIX</button>
                                    </div>

                                    {activeTab === 'deposit' ? (
                                        <div>
                                            <p style={{fontSize: '14px', color: 'var(--text-secondary)', marginBottom: '16px', lineHeight: '1.7'}}>
                                                Envie um PIX para o endere√ßo abaixo. Os tokens efixDI ser√£o mintados automaticamente na sua wallet ap√≥s confirma√ß√£o.
                                            </p>
                                            <div className="pix-info">
                                                <div style={{fontSize: '12px', color: 'var(--text-muted)', marginBottom: '6px'}}>Chave PIX (CNPJ)</div>
                                                <div className="pix-key">XX.XXX.XXX/0001-XX</div>
                                                <button className="copy-btn" onClick={() => {
                                                    navigator.clipboard.writeText('XX.XXX.XXX/0001-XX');
                                                    addToast('Chave PIX copiada!', 'success');
                                                }}>
                                                    Copiar Chave
                                                </button>
                                            </div>
                                            <div style={{marginTop: '16px', padding: '12px', background: 'rgba(0,204,255,0.06)', borderRadius: 'var(--radius-sm)', fontSize: '13px', color: 'var(--text-secondary)'}}>
                                                ‚ÑπÔ∏è O auto-minting monitora dep√≥sitos PIX e minta tokens efixDI 1:1 com o valor em BRL depositado.
                                            </div>
                                        </div>
                                    ) : (
                                        <div>
                                            <div className="input-group">
                                                <div className="input-label">
                                                    <span>Valor em efixDI</span>
                                                    <button className="max-btn" onClick={() => setWithdrawAmount(balances.efixDI)}>MAX</button>
                                                </div>
                                                <input
                                                    type="number"
                                                    className="input-field"
                                                    placeholder="0.00"
                                                    value={withdrawAmount}
                                                    onChange={(e) => setWithdrawAmount(e.target.value)}
                                                />
                                            </div>
                                            <p style={{fontSize: '13px', color: 'var(--text-muted)', marginBottom: '16px'}}>
                                                Os tokens ser√£o queimados e o valor equivalente em BRL enviado via PIX.
                                            </p>
                                            <button
                                                className="btn btn-danger"
                                                onClick={handleWithdraw}
                                                disabled={!account || !withdrawAmount || loading.withdraw}
                                            >
                                                {loading.withdraw ? <span className="spinner"></span> : 'üì§'}
                                                {loading.withdraw ? 'Processando...' : 'Solicitar Saque PIX'}
                                            </button>
                                        </div>
                                    )}
                                </div>

                                {/* Leverage Control */}
                                <div className="card">
                                    <div className="card-header">
                                        <div className="card-title">
                                            <div className="card-icon orange">‚ö°</div>
                                            Alavancagem
                                        </div>
                                        <span className="card-badge beta">Beta</span>
                                    </div>

                                    <div className="slider-container">
                                        <div className="slider-header">
                                            <span className="slider-label">Loops de alavancagem</span>
                                            <span className="slider-value">{leverageLoops}x</span>
                                        </div>
                                        <input
                                            type="range"
                                            min="1"
                                            max="4"
                                            value={leverageLoops}
                                            onChange={(e) => setLeverageLoops(parseInt(e.target.value))}
                                        />
                                    </div>

                                    <div style={{padding: '16px', background: 'var(--bg-secondary)', borderRadius: 'var(--radius-md)', marginBottom: '16px'}}>
                                        <div className="stat-row" style={{borderBottom: 'none', padding: '8px 0'}}>
                                            <span className="stat-label">CDI Base</span>
                                            <span className="stat-value">15.00%</span>
                                        </div>
                                        <div className="stat-row" style={{borderBottom: 'none', padding: '8px 0'}}>
                                            <span className="stat-label">Custo USDC</span>
                                            <span className="stat-value orange">-5.00%</span>
                                        </div>
                                        <div className="stat-row" style={{borderBottom: 'none', padding: '8px 0'}}>
                                            <span className="stat-label">APY Estimado</span>
                                            <span className="stat-value green" style={{fontSize: '20px'}}>{calcAPY(leverageLoops)}%</span>
                                        </div>
                                    </div>

                                    <div className="btn-group">
                                        <button
                                            className="btn btn-primary"
                                            onClick={handleLeverage}
                                            disabled={!account || loading.leverage || parseFloat(position.principal) <= 0}
                                        >
                                            {loading.leverage ? <span className="spinner"></span> : 'üöÄ'}
                                            {loading.leverage ? 'Alavancando...' : `Aplicar ${leverageLoops} Loop(s)`}
                                        </button>
                                        <button
                                            className="btn btn-secondary"
                                            onClick={handleDeleverage}
                                            disabled={!account || loading.deleverage || position.leverageLoops <= 0}
                                        >
                                            {loading.deleverage ? <span className="spinner"></span> : 'üîª'}
                                            {loading.deleverage ? 'Processando...' : 'Desalavancar'}
                                        </button>
                                    </div>
                                </div>
                            </div>

                            {/* Transaction History */}
                            <div className="section-title" style={{marginTop: '8px'}}>Hist√≥rico</div>
                            <div className="card">
                                <div className="card-header">
                                    <div className="card-title">
                                        <div className="card-icon cyan">üìú</div>
                                        Transa√ß√µes Recentes
                                    </div>
                                </div>
                                {transactions.length > 0 ? (
                                    <div className="tx-log">
                                        {transactions.map((tx, i) => (
                                            <div key={i} className="tx-item">
                                                <div className={`tx-icon ${tx.icon}`}>
                                                    {tx.icon === 'deposit' ? '‚Üì' : tx.icon === 'withdraw' ? '‚Üë' : '‚ö°'}
                                                </div>
                                                <div className="tx-details">
                                                    <div className="tx-type">{tx.type}</div>
                                                    <div className="tx-hash">
                                                        <a href={`https://polygonscan.com/tx/${tx.hash}`} target="_blank" rel="noreferrer">
                                                            {tx.hash.slice(0, 14)}...{tx.hash.slice(-8)}
                                                        </a>
                                                    </div>
                                                </div>
                                                <div className="tx-amount" style={{color: tx.icon === 'deposit' ? 'var(--accent-green)' : tx.icon === 'withdraw' ? 'var(--accent-red)' : 'var(--accent-cyan)'}}>
                                                    {tx.amount}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                ) : (
                                    <div className="empty-state">
                                        <div className="empty-icon">üì≠</div>
                                        <p>Nenhuma transa√ß√£o nesta sess√£o. Suas opera√ß√µes aparecer√£o aqui.</p>
                                    </div>
                                )}
                            </div>
                        </>
                    )}

                    {activeSection === 'contracts' && (
                        <>
                            <div className="section-title">Smart Contracts ‚Äî Polygon Mainnet</div>
                            <div className="card">
                                <div className="card-header">
                                    <div className="card-title">
                                        <div className="card-icon green">üìÑ</div>
                                        Polygon Mainnet (Chain ID: 137)
                                    </div>
                                </div>

                                <div className="contract-address">
                                    <span className="ca-label">EfixDIToken</span>
                                    <span className="ca-value">{CONTRACTS.efixDIToken}</span>
                                    <a className="ca-link" href={`https://polygonscan.com/address/${CONTRACTS.efixDIToken}`} target="_blank" rel="noreferrer">Polygonscan ‚Üó</a>
                                </div>
                                <div className="contract-address">
                                    <span className="ca-label">VaultV2</span>
                                    <span className="ca-value">{CONTRACTS.vault}</span>
                                    <a className="ca-link" href={`https://polygonscan.com/address/${CONTRACTS.vault}`} target="_blank" rel="noreferrer">Polygonscan ‚Üó</a>
                                </div>
                                <div className="contract-address">
                                    <span className="ca-label">Gateway</span>
                                    <span className="ca-value">{CONTRACTS.gateway}</span>
                                    <a className="ca-link" href={`https://polygonscan.com/address/${CONTRACTS.gateway}`} target="_blank" rel="noreferrer">Polygonscan ‚Üó</a>
                                </div>
                                <div className="contract-address">
                                    <span className="ca-label">OFT Adapter</span>
                                    <span className="ca-value">{CONTRACTS.oftAdapter}</span>
                                    <a className="ca-link" href={`https://polygonscan.com/address/${CONTRACTS.oftAdapter}`} target="_blank" rel="noreferrer">Polygonscan ‚Üó</a>
                                </div>
                                <div className="contract-address">
                                    <span className="ca-label">USDC.e</span>
                                    <span className="ca-value">{CONTRACTS.usdce}</span>
                                    <a className="ca-link" href={`https://polygonscan.com/address/${CONTRACTS.usdce}`} target="_blank" rel="noreferrer">Polygonscan ‚Üó</a>
                                </div>
                                <div className="contract-address">
                                    <span className="ca-label">BRTH</span>
                                    <span className="ca-value">{CONTRACTS.brth}</span>
                                    <a className="ca-link" href={`https://polygonscan.com/address/${CONTRACTS.brth}`} target="_blank" rel="noreferrer">Polygonscan ‚Üó</a>
                                </div>
                                <div className="contract-address">
                                    <span className="ca-label">Oracle</span>
                                    <span className="ca-value">{CONTRACTS.oracle}</span>
                                    <a className="ca-link" href={`https://polygonscan.com/address/${CONTRACTS.oracle}`} target="_blank" rel="noreferrer">Polygonscan ‚Üó</a>
                                </div>
                            </div>

                            <div className="section-title" style={{marginTop: '24px'}}>Smart Contracts ‚Äî Base Mainnet</div>
                            <div className="card">
                                <div className="card-header">
                                    <div className="card-title">
                                        <div className="card-icon cyan">üìÑ</div>
                                        Base Mainnet (Chain ID: 8453)
                                    </div>
                                </div>

                                <div className="contract-address">
                                    <span className="ca-label">EfixDIBase</span>
                                    <span className="ca-value">{CONTRACTS_BASE.efixDITokenBase}</span>
                                    <a className="ca-link" href={`https://basescan.org/address/${CONTRACTS_BASE.efixDITokenBase}`} target="_blank" rel="noreferrer">BaseScan ‚Üó</a>
                                </div>
                                <div className="contract-address">
                                    <span className="ca-label">BRL Oracle</span>
                                    <span className="ca-value">{CONTRACTS_BASE.brlOracle}</span>
                                    <a className="ca-link" href={`https://basescan.org/address/${CONTRACTS_BASE.brlOracle}`} target="_blank" rel="noreferrer">BaseScan ‚Üó</a>
                                </div>
                                <div className="contract-address">
                                    <span className="ca-label">MorphoVaultV2</span>
                                    <span className="ca-value">{CONTRACTS_BASE.morphoVaultV2}</span>
                                    <a className="ca-link" href={`https://basescan.org/address/${CONTRACTS_BASE.morphoVaultV2}`} target="_blank" rel="noreferrer">BaseScan ‚Üó</a>
                                </div>
                                <div className="contract-address">
                                    <span className="ca-label">OFT Base</span>
                                    <span className="ca-value">{CONTRACTS_BASE.oftBase}</span>
                                    <a className="ca-link" href={`https://basescan.org/address/${CONTRACTS_BASE.oftBase}`} target="_blank" rel="noreferrer">BaseScan ‚Üó</a>
                                </div>
                                <div className="contract-address">
                                    <span className="ca-label" style={{minWidth: '100px'}}>Morpho Market</span>
                                    <span className="ca-value" style={{fontSize: '10px'}}>{CONTRACTS_BASE.morphoMarketId}</span>
                                    <a className="ca-link" href="https://app.morpho.org" target="_blank" rel="noreferrer">Morpho ‚Üó</a>
                                </div>
                            </div>

                                <div style={{marginTop: '24px', padding: '16px', background: 'var(--bg-secondary)', borderRadius: 'var(--radius-md)'}}>
                                    <div className="stat-row">
                                        <span className="stat-label">Redes</span>
                                        <span className="stat-value">Polygon + Base</span>
                                    </div>
                                    <div className="stat-row">
                                        <span className="stat-label">Bridge</span>
                                        <span className="stat-value">LayerZero V2 (OFT)</span>
                                    </div>
                                    <div className="stat-row">
                                        <span className="stat-label">Lending</span>
                                        <span className="stat-value">Morpho Blue (77% LTV)</span>
                                    </div>
                                    <div className="stat-row">
                                        <span className="stat-label">Stablecoin</span>
                                        <span className="stat-value">USDC.e (Bridged)</span>
                                    </div>
                                    <div className="stat-row">
                                        <span className="stat-label">Oracle</span>
                                        <span className="stat-value">Chainlink BRL/USD</span>
                                    </div>
                                    <div className="stat-row">
                                        <span className="stat-label">Auditoria</span>
                                        <span className="stat-value orange">Em andamento ‚Äî OpenZeppelin</span>
                                    </div>
                                </div>
                            </div>

                            <div className="section-title" style={{marginTop: '24px'}}>Par√¢metros do Protocolo</div>
                            <div className="dashboard-grid triple">
                                <div className="card">
                                    <div style={{textAlign: 'center', padding: '12px 0'}}>
                                        <div style={{fontFamily: 'var(--font-mono)', fontSize: '32px', fontWeight: '700', color: 'var(--accent-green)'}}>75%</div>
                                        <div style={{fontSize: '13px', color: 'var(--text-muted)', marginTop: '4px'}}>Max LTV</div>
                                    </div>
                                </div>
                                <div className="card">
                                    <div style={{textAlign: 'center', padding: '12px 0'}}>
                                        <div style={{fontFamily: 'var(--font-mono)', fontSize: '32px', fontWeight: '700', color: 'var(--accent-orange)'}}>1.15</div>
                                        <div style={{fontSize: '13px', color: 'var(--text-muted)', marginTop: '4px'}}>Min Health Factor</div>
                                    </div>
                                </div>
                                <div className="card">
                                    <div style={{textAlign: 'center', padding: '12px 0'}}>
                                        <div style={{fontFamily: 'var(--font-mono)', fontSize: '32px', fontWeight: '700', color: 'var(--accent-cyan)'}}>4</div>
                                        <div style={{fontSize: '13px', color: 'var(--text-muted)', marginTop: '4px'}}>Max Loops</div>
                                    </div>
                                </div>
                            </div>

                            <div className="section-title" style={{marginTop: '24px'}}>Regulamenta√ß√£o</div>
                            <div className="card">
                                <div className="card-header">
                                    <div className="card-title">
                                        <div className="card-icon green">üèõÔ∏è</div>
                                        Compliance
                                    </div>
                                </div>
                                <div className="stat-row">
                                    <span className="stat-label">Emissor</span>
                                    <span className="stat-value">Efix Securitizadora</span>
                                </div>
                                <div className="stat-row">
                                    <span className="stat-label">Regula√ß√£o</span>
                                    <span className="stat-value">CVM Resolu√ß√£o 88/2022</span>
                                </div>
                                <div className="stat-row">
                                    <span className="stat-label">Infraestrutura Banc√°ria</span>
                                    <span className="stat-value">HausBank (iHold)</span>
                                </div>
                                <div className="stat-row">
                                    <span className="stat-label">Fundo DI Subjacente</span>
                                    <span className="stat-value">Genial IAAS (pendente)</span>
                                </div>
                                <div className="stat-row">
                                    <span className="stat-label">Seguran√ßa</span>
                                    <span className="stat-value orange">Auditoria OpenZeppelin em curso</span>
                                </div>
                            </div>
                        </>
                    )}
                </main>

                {/* Footer */}
                <footer className="footer">
                    <p>
                        efixDI+ Protocol ‚Äî Constru√≠do por <a href="/">Efix Securitizadora</a> ¬∑ 
                        Regulado pela CVM ¬∑ Polygon Mainnet ¬∑ 
                        <a href="https://polygonscan.com/address/0x2eA512b4C5e53A8c1302AC8ba2d43c5DA90b307C" target="_blank" rel="noreferrer"> Verificar Contratos</a>
                    </p>
                </footer>
            </div>
        );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
